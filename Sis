# Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„ - Flask + Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª + Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„Ø§Øª + Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª + Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© + Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª
# Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ: pos_desktop.py
import os
import shutil
import zipfile
import threading
import time
from datetime import datetime, timedelta, date
from flask import Flask, render_template_string, request, redirect, url_for, jsonify, flash
from flask_sqlalchemy import SQLAlchemy
from sqlalchemy import extract
from PyQt5.QtWidgets import QApplication, QMainWindow, QVBoxLayout, QWidget, QPushButton, QMessageBox
from PyQt5.QtWebEngineWidgets import QWebEngineView
import sys
# Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Flask
app = Flask(__name__)
app.secret_key = 'pos_secret_key'
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///pos.db'
app.config['SQLALCHEMY_TRACK_MODIFICATIONS'] = False
db = SQLAlchemy(app)
# ===========================================
# Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Models
# ===========================================
class Product(db.Model):
Â Â Â Â id = db.Column(db.Integer, primary_key=True)
Â Â Â Â name = db.Column(db.String(100))
Â Â Â Â price = db.Column(db.Float)
Â Â Â Â quantity = db.Column(db.Integer)
Â Â Â Â added_date = db.Column(db.Date, default=date.today)
Â Â Â Â deleted = db.Column(db.Boolean, default=False)
class Supplier(db.Model):
Â Â Â Â id = db.Column(db.Integer, primary_key=True)
Â Â Â Â name = db.Column(db.String(100))
Â Â Â Â phone = db.Column(db.String(20))
Â Â Â Â address = db.Column(db.String(200))
Â Â Â Â deleted = db.Column(db.Boolean, default=False)
class Sale(db.Model):
Â Â Â Â id = db.Column(db.Integer, primary_key=True)
Â Â Â Â product_name = db.Column(db.String(100))
Â Â Â Â quantity = db.Column(db.Integer)
Â Â Â Â total = db.Column(db.Float)
Â Â Â Â date = db.Column(db.Date, default=date.today)
Â Â Â Â deleted = db.Column(db.Boolean, default=False)
class Expense(db.Model):
Â Â Â Â id = db.Column(db.Integer, primary_key=True)
Â Â Â Â description = db.Column(db.String(200))
Â Â Â Â amount = db.Column(db.Float)
Â Â Â Â date = db.Column(db.Date, default=date.today)
Â Â Â Â deleted = db.Column(db.Boolean, default=False)
db.create_all()
# ===========================================
# Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª Recycle Bin (ØªÙ†Ø¸ÙŠÙ ØªÙ„Ù‚Ø§Ø¦ÙŠ ÙƒÙ„ 7 Ø£ÙŠØ§Ù…)
# ===========================================
def clean_recycle_bin():
Â Â Â Â while True:
Â Â Â Â Â Â Â Â time.sleep(86400 * 7)Â Â # ÙƒÙ„ 7 Ø£ÙŠØ§Ù…
Â Â Â Â Â Â Â Â with app.app_context():
Â Â Â Â Â Â Â Â Â Â Â Â for model in [Product, Supplier, Sale, Expense]:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â deleted_items = model.query.filter_by(deleted=True).all()
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â for item in deleted_items:
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â db.session.delete(item)
Â Â Â Â Â Â Â Â Â Â Â Â db.session.commit()
clean_thread = threading.Thread(target=clean_recycle_bin, daemon=True)
clean_thread.start()
# ===========================================
# Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Backup & Restore
# ===========================================
BACKUP_FOLDER = "backups"
if not os.path.exists(BACKUP_FOLDER):
Â Â Â Â os.makedirs(BACKUP_FOLDER)
def create_backup():
Â Â Â Â backup_filename = f"backup_{datetime.now().strftime('%Y%m%d_%H%M%S')}.zip"
Â Â Â Â backup_path = os.path.join(BACKUP_FOLDER, backup_filename)
Â Â Â Â with zipfile.ZipFile(backup_path, 'w') as zipf:
Â Â Â Â Â Â Â Â zipf.write('pos.db')
Â Â Â Â return backup_filename
def restore_backup(backup_filename):
Â Â Â Â backup_path = os.path.join(BACKUP_FOLDER, backup_filename)
Â Â Â Â with zipfile.ZipFile(backup_path, 'r') as zipf:
Â Â Â Â Â Â Â Â zipf.extractall()
Â Â Â Â return True
# ===========================================
# ØµÙØ­Ø§Øª Flask
# ===========================================
@app.route('/')
def index():
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>Ù†Ø¸Ø§Ù… Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª - Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</h2>
Â Â Â Â Â Â Â Â <a href="/sales">ğŸ“Š Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</a><br>
Â Â Â Â Â Â Â Â <a href="/expenses">ğŸ’¸ Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</a><br>
Â Â Â Â Â Â Â Â <a href="/products">ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</a><br>
Â Â Â Â Â Â Â Â <a href="/suppliers">ğŸ‘¥ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</a><br>
Â Â Â Â Â Â Â Â <a href="/recycle_bin">ğŸ—‘ï¸ Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª</a><br>
Â Â Â Â Â Â Â Â <a href="/backup">ğŸ’¾ Ø¥Ù†Ø´Ø§Ø¡ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</a><br>
Â Â Â Â Â Â Â Â <a href="/restore">ğŸ” Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ©</a><br>
Â Â Â Â """)
# ===========================================
# Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª (Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ / Ø­Ø°Ù)
# ===========================================
@app.route('/expenses', methods=['GET', 'POST'])
def manage_expenses():
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â desc = request.form['description']
Â Â Â Â Â Â Â Â amount = float(request.form['amount'])
Â Â Â Â Â Â Â Â exp = Expense(description=desc, amount=amount)
Â Â Â Â Â Â Â Â db.session.add(exp)
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­')
Â Â Â Â Â Â Â Â return redirect(url_for('manage_expenses'))
Â Â Â Â expenses = Expense.query.filter_by(deleted=False).all()
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h2>
Â Â Â Â Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„ÙˆØµÙ: <input name="description">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ù…Ø¨Ù„Øº: <input name="amount" type="number" step="0.01">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit">Ø¥Ø¶Ø§ÙØ©</button>
Â Â Â Â Â Â Â Â </form>
Â Â Â Â Â Â Â Â <br>
Â Â Â Â Â Â Â Â <table border="1">
Â Â Â Â Â Â Â Â Â Â Â Â <tr><th>Ø§Ù„ÙˆØµÙ</th><th>Ø§Ù„Ù…Ø¨Ù„Øº</th><th>ØªØ§Ø±ÙŠØ®</th><th>ØªØ­ÙƒÙ…</th></tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% for e in expenses %}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{ e.description }}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{ e.amount }}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{ e.date }}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <a href="/edit_expense/{{e.id}}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a> | 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <a href="/delete_expense/{{e.id}}">ğŸ—‘ï¸ Ø­Ø°Ù</a>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â </table>
Â Â Â Â Â Â Â Â <br><a href="/">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
Â Â Â Â """, expenses=expenses)
@app.route('/edit_expense/<int:id>', methods=['GET', 'POST'])
def edit_expense(id):
Â Â Â Â exp = Expense.query.get_or_404(id)
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â exp.description = request.form['description']
Â Â Â Â Â Â Â Â exp.amount = float(request.form['amount'])
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­')
Â Â Â Â Â Â Â Â return redirect(url_for('manage_expenses'))
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ</h2>
Â Â Â Â Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„ÙˆØµÙ: <input name="description" value="{{exp.description}}">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ù…Ø¨Ù„Øº: <input name="amount" type="number" value="{{exp.amount}}">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit">ğŸ’¾ Ø­ÙØ¸</button>
Â Â Â Â Â Â Â Â </form>
Â Â Â Â """, exp=exp)
@app.route('/delete_expense/<int:id>')
def delete_expense(id):
Â Â Â Â exp = Expense.query.get_or_404(id)
Â Â Â Â exp.deleted = True
Â Â Â Â db.session.commit()
Â Â Â Â flash('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª')
Â Â Â Â return redirect(url_for('manage_expenses'))
# Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø£ÙˆÙ„ - ØªØ§Ø¨Ø¹ ÙÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ ğŸ‘‡
# Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ - Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª + Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª + Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
# ===========================================
# Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
# ===========================================
@app.route('/products', methods=['GET', 'POST'])
def manage_products():
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â name = request.form['name']
Â Â Â Â Â Â Â Â price = float(request.form['price'])
Â Â Â Â Â Â Â Â qty = int(request.form['quantity'])
Â Â Â Â Â Â Â Â p = Product(name=name, price=price, quantity=qty)
Â Â Â Â Â Â Â Â db.session.add(p)
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­')
Â Â Â Â Â Â Â Â return redirect(url_for('manage_products'))
Â Â Â Â products = Product.query.filter_by(deleted=False).all()
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>ğŸ“¦ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
Â Â Â Â Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ø§Ø³Ù…: <input name="name">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ø³Ø¹Ø±: <input name="price" type="number" step="0.01">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„ÙƒÙ…ÙŠØ©: <input name="quantity" type="number">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit">Ø¥Ø¶Ø§ÙØ©</button>
Â Â Â Â Â Â Â Â </form>
Â Â Â Â Â Â Â Â <br>
Â Â Â Â Â Â Â Â <table border="1">
Â Â Â Â Â Â Â Â Â Â Â Â <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©</th><th>ØªØ­ÙƒÙ…</th></tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% for p in products %}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{p.name}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{p.price}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{p.quantity}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{p.added_date}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <a href="/edit_product/{{p.id}}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a> | 
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <a href="/delete_product/{{p.id}}">ğŸ—‘ï¸ Ø­Ø°Ù</a>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â </table>
Â Â Â Â Â Â Â Â <br><a href="/">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
Â Â Â Â """, products=products)
@app.route('/edit_product/<int:id>', methods=['GET', 'POST'])
def edit_product(id):
Â Â Â Â p = Product.query.get_or_404(id)
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â p.name = request.form['name']
Â Â Â Â Â Â Â Â p.price = float(request.form['price'])
Â Â Â Â Â Â Â Â p.quantity = int(request.form['quantity'])
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash('ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­')
Â Â Â Â Â Â Â Â return redirect(url_for('manage_products'))
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
Â Â Â Â Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ø§Ø³Ù…: <input name="name" value="{{p.name}}">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ø³Ø¹Ø±: <input name="price" type="number" value="{{p.price}}">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„ÙƒÙ…ÙŠØ©: <input name="quantity" type="number" value="{{p.quantity}}">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit">ğŸ’¾ Ø­ÙØ¸</button>
Â Â Â Â Â Â Â Â </form>
Â Â Â Â """, p=p)
@app.route('/delete_product/<int:id>')
def delete_product(id):
Â Â Â Â p = Product.query.get_or_404(id)
Â Â Â Â p.deleted = True
Â Â Â Â db.session.commit()
Â Â Â Â flash('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª')
Â Â Â Â return redirect(url_for('manage_products'))
# ===========================================
# Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
# ===========================================
@app.route('/suppliers', methods=['GET', 'POST'])
def manage_suppliers():
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â name = request.form['name']
Â Â Â Â Â Â Â Â phone = request.form['phone']
Â Â Â Â Â Â Â Â address = request.form['address']
Â Â Â Â Â Â Â Â s = Supplier(name=name, phone=phone, address=address)
Â Â Â Â Â Â Â Â db.session.add(s)
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨Ù†Ø¬Ø§Ø­')
Â Â Â Â Â Â Â Â return redirect(url_for('manage_suppliers'))
Â Â Â Â suppliers = Supplier.query.filter_by(deleted=False).all()
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>ğŸ‘¥ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h2>
Â Â Â Â Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ø§Ø³Ù…: <input name="name">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ù‡Ø§ØªÙ: <input name="phone">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: <input name="address">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit">Ø¥Ø¶Ø§ÙØ©</button>
Â Â Â Â Â Â Â Â </form>
Â Â Â Â Â Â Â Â <br>
Â Â Â Â Â Â Â Â <table border="1">
Â Â Â Â Â Â Â Â Â Â Â Â <tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù‡Ø§ØªÙ</th><th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th><th>ØªØ­ÙƒÙ…</th></tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% for s in suppliers %}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.name}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.phone}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.address}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <a href="/delete_supplier/{{s.id}}">ğŸ—‘ï¸ Ø­Ø°Ù</a>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â </table>
Â Â Â Â Â Â Â Â <br><a href="/">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
Â Â Â Â """, suppliers=suppliers)
@app.route('/delete_supplier/<int:id>')
def delete_supplier(id):
Â Â Â Â s = Supplier.query.get_or_404(id)
Â Â Â Â s.deleted = True
Â Â Â Â db.session.commit()
Â Â Â Â flash('ØªÙ… Ù†Ù‚Ù„ Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¥Ù„Ù‰ Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª')
Â Â Â Â return redirect(url_for('manage_suppliers'))
# ===========================================
# Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ© ÙˆØ§Ù„Ø´Ù‡Ø±ÙŠØ©
# ===========================================
@app.route('/sales', methods=['GET', 'POST'])
def sales_page():
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â pname = request.form['product_name']
Â Â Â Â Â Â Â Â qty = int(request.form['quantity'])
Â Â Â Â Â Â Â Â product = Product.query.filter_by(name=pname, deleted=False).first()
Â Â Â Â Â Â Â Â if product and product.quantity >= qty:
Â Â Â Â Â Â Â Â Â Â Â Â total = qty * product.price
Â Â Â Â Â Â Â Â Â Â Â Â product.quantity -= qty
Â Â Â Â Â Â Â Â Â Â Â Â sale = Sale(product_name=pname, quantity=qty, total=total)
Â Â Â Â Â Â Â Â Â Â Â Â db.session.add(sale)
Â Â Â Â Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â Â Â Â Â flash('âœ… ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­')
Â Â Â Â Â Â Â Â else:
Â Â Â Â Â Â Â Â Â Â Â Â flash('âŒ Ø§Ù„ÙƒÙ…ÙŠØ© ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©')
Â Â Â Â Â Â Â Â return redirect(url_for('sales_page'))
Â Â Â Â today = date.today()
Â Â Â Â month_sales = Sale.query.filter(extract('month', Sale.date) == today.month, Sale.deleted == False).all()
Â Â Â Â today_sales = Sale.query.filter(Sale.date == today, Sale.deleted == False).all()
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>ğŸ“Š Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h2>
Â Â Â Â Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„Ù…Ù†ØªØ¬: <input name="product_name">
Â Â Â Â Â Â Â Â Â Â Â Â Ø§Ù„ÙƒÙ…ÙŠØ©: <input name="quantity" type="number">
Â Â Â Â Â Â Â Â Â Â Â Â <button type="submit">Ø¨ÙŠØ¹</button>
Â Â Â Â Â Â Â Â </form>
Â Â Â Â Â Â Â Â <hr>
Â Â Â Â Â Â Â Â <h3>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
Â Â Â Â Â Â Â Â <table border="1">
Â Â Â Â Â Â Â Â Â Â Â Â <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% for s in today_sales %}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.product_name}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.quantity}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.total}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.date}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â </table>
Â Â Â Â Â Â Â Â <h3>Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±</h3>
Â Â Â Â Â Â Â Â <table border="1">
Â Â Â Â Â Â Â Â Â Â Â Â <tr><th>Ø§Ù„Ù…Ù†ØªØ¬</th><th>Ø§Ù„ÙƒÙ…ÙŠØ©</th><th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th></tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% for s in month_sales %}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <tr>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.product_name}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.quantity}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.total}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <td>{{s.date}}</td>
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </tr>
Â Â Â Â Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â </table>
Â Â Â Â Â Â Â Â <br><a href="/">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
Â Â Â Â """, today_sales=today_sales, month_sales=month_sales)
# ===========================================
# Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª Ø§Ù„Ø¹Ø§Ù…Ø©
# ===========================================
@app.route('/recycle_bin')
def recycle_bin():
Â Â Â Â products = Product.query.filter_by(deleted=True).all()
Â Â Â Â suppliers = Supplier.query.filter_by(deleted=True).all()
Â Â Â Â sales = Sale.query.filter_by(deleted=True).all()
Â Â Â Â expenses = Expense.query.filter_by(deleted=True).all()
Â Â Â Â return render_template_string("""
Â Â Â Â Â Â Â Â <h2>ğŸ—‘ï¸ Ø³Ù„Ø© Ø§Ù„Ù…Ø­Ø°ÙˆÙØ§Øª</h2>
Â Â Â Â Â Â Â Â <h3>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
Â Â Â Â Â Â Â Â {% for p in products %}
Â Â Â Â Â Â Â Â Â Â Â Â {{p.name}} - <a href="/restore/product/{{p.id}}">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a><br>
Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â <h3>Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h3>
Â Â Â Â Â Â Â Â {% for s in suppliers %}
Â Â Â Â Â Â Â Â Â Â Â Â {{s.name}} - <a href="/restore/supplier/{{s.id}}">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a><br>
Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â <h3>Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
Â Â Â Â Â Â Â Â {% for s in sales %}
Â Â Â Â Â Â Â Â Â Â Â Â {{s.product_name}} - <a href="/restore/sale/{{s.id}}">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a><br>
Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â <h3>Ø§Ù„Ù…ØµØ±ÙˆÙØ§Øª</h3>
Â Â Â Â Â Â Â Â {% for e in expenses %}
Â Â Â Â Â Â Â Â Â Â Â Â {{e.description}} - <a href="/restore/expense/{{e.id}}">Ø§Ø³ØªØ±Ø¬Ø§Ø¹</a><br>
Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â <br><a href="/">ğŸ”™ Ø±Ø¬ÙˆØ¹</a>
Â Â Â Â """, products=products, suppliers=suppliers, sales=sales, expenses=expenses)
@app.route('/restore/<string:model>/<int:id>')
def restore_item(model, id):
Â Â Â Â models = {"product": Product, "supplier": Supplier, "sale": Sale, "expense": Expense}
Â Â Â Â if model in models:
Â Â Â Â Â Â Â Â item = models[model].query.get_or_404(id)
Â Â Â Â Â Â Â Â item.deleted = False
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash("âœ… ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø¹Ù†ØµØ± Ø¨Ù†Ø¬Ø§Ø­")
Â Â Â Â return redirect(url_for('recycle_bin'))
# Ù†Ù‡Ø§ÙŠØ© Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù†ÙŠ - ØªØ§Ø¨Ø¹ ÙÙŠ Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø« ğŸ‘‡
# ================================
# Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø«Ø§Ù„Ø« - Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ† ÙˆØ§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©/Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
# ================================
# Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
class Supplier(db.Model):
Â Â Â Â id = db.Column(db.Integer, primary_key=True)
Â Â Â Â name = db.Column(db.String(100), nullable=False)
Â Â Â Â phone = db.Column(db.String(20))
Â Â Â Â address = db.Column(db.String(200))
Â Â Â Â created_at = db.Column(db.DateTime, default=datetime.utcnow)
# Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
class Product(db.Model):
Â Â Â Â id = db.Column(db.Integer, primary_key=True)
Â Â Â Â name = db.Column(db.String(100), nullable=False)
Â Â Â Â price = db.Column(db.Float, nullable=False)
Â Â Â Â supplier_id = db.Column(db.Integer, db.ForeignKey('supplier.id'))
Â Â Â Â created_at = db.Column(db.DateTime, default=datetime.utcnow)
Â Â Â Â supplier = db.relationship('Supplier', backref=db.backref('products', lazy=True))
# Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…ÙŠØ©
@app.route('/sales/today')
def sales_today():
Â Â Â Â today = date.today()
Â Â Â Â sales = Sale.query.filter(
Â Â Â Â Â Â Â Â extract('year', Sale.date) == today.year,
Â Â Â Â Â Â Â Â extract('month', Sale.date) == today.month,
Â Â Â Â Â Â Â Â extract('day', Sale.date) == today.day
Â Â Â Â ).all()
Â Â Â Â return render_template_string("""
Â Â Â Â <h2>ğŸ“… Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h2>
Â Â Â Â <ul>
Â Â Â Â {% for sale in sales %}
Â Â Â Â Â Â Â Â <li>{{ sale.item_name }} - {{ sale.amount }} Ø¬Ù†ÙŠÙ‡</li>
Â Â Â Â {% endfor %}
Â Â Â Â </ul>
Â Â Â Â <a href="/">ğŸ  Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
Â Â Â Â """, sales=sales)
# Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±ÙŠØ©
@app.route('/sales/month')
def sales_month():
Â Â Â Â today = date.today()
Â Â Â Â sales = Sale.query.filter(
Â Â Â Â Â Â Â Â extract('year', Sale.date) == today.year,
Â Â Â Â Â Â Â Â extract('month', Sale.date) == today.month
Â Â Â Â ).all()
Â Â Â Â return render_template_string("""
Â Â Â Â <h2>ğŸ“† Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„Ø´Ù‡Ø±</h2>
Â Â Â Â <ul>
Â Â Â Â {% for sale in sales %}
Â Â Â Â Â Â Â Â <li>{{ sale.item_name }} - {{ sale.amount }} Ø¬Ù†ÙŠÙ‡</li>
Â Â Â Â {% endfor %}
Â Â Â Â </ul>
Â Â Â Â <a href="/">ğŸ  Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
Â Â Â Â """, sales=sales)
# ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†
@app.route('/suppliers')
def suppliers():
Â Â Â Â suppliers = Supplier.query.all()
Â Â Â Â return render_template_string("""
Â Â Â Â <h2>ğŸ‘¨â€ğŸ”§ Ø§Ù„Ù…ÙˆØ±Ø¯ÙŠÙ†</h2>
Â Â Â Â <a href="/suppliers/add">â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯</a>
Â Â Â Â <ul>
Â Â Â Â {% for s in suppliers %}
Â Â Â Â Â Â Â Â <li>{{ s.name }} - {{ s.phone }} - {{ s.address }}</li>
Â Â Â Â {% endfor %}
Â Â Â Â </ul>
Â Â Â Â <a href="/">ğŸ  Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
Â Â Â Â """, suppliers=suppliers)
@app.route('/suppliers/add', methods=['GET', 'POST'])
def add_supplier():
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â name = request.form['name']
Â Â Â Â Â Â Â Â phone = request.form['phone']
Â Â Â Â Â Â Â Â address = request.form['address']
Â Â Â Â Â Â Â Â new_supplier = Supplier(name=name, phone=phone, address=address)
Â Â Â Â Â Â Â Â db.session.add(new_supplier)
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ±Ø¯ Ø¨Ù†Ø¬Ø§Ø­ âœ…")
Â Â Â Â Â Â Â Â return redirect('/suppliers')
Â Â Â Â return render_template_string("""
Â Â Â Â <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ±Ø¯ Ø¬Ø¯ÙŠØ¯</h2>
Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Ø§Ù„Ø§Ø³Ù…: <input type="text" name="name"><br>
Â Â Â Â Â Â Â Â Ø§Ù„Ù‡Ø§ØªÙ: <input type="text" name="phone"><br>
Â Â Â Â Â Â Â Â Ø§Ù„Ø¹Ù†ÙˆØ§Ù†: <input type="text" name="address"><br>
Â Â Â Â Â Â Â Â <button type="submit">Ø­ÙØ¸</button>
Â Â Â Â </form>
Â Â Â Â """)
# ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
@app.route('/products')
def products():
Â Â Â Â products = Product.query.all()
Â Â Â Â return render_template_string("""
Â Â Â Â <h2>ğŸ“¦ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h2>
Â Â Â Â <a href="/products/add">â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬</a>
Â Â Â Â <ul>
Â Â Â Â {% for p in products %}
Â Â Â Â Â Â Â Â <li>{{ p.name }} - {{ p.price }} Ø¬Ù†ÙŠÙ‡ 
Â Â Â Â Â Â Â Â <a href="/products/edit/{{p.id}}">âœï¸ ØªØ¹Ø¯ÙŠÙ„</a>
Â Â Â Â Â Â Â Â <a href="/products/delete/{{p.id}}">ğŸ—‘ï¸ Ø­Ø°Ù</a>
Â Â Â Â Â Â Â Â </li>
Â Â Â Â {% endfor %}
Â Â Â Â </ul>
Â Â Â Â <a href="/">ğŸ  Ø¹ÙˆØ¯Ø© Ù„Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
Â Â Â Â """, products=products)
@app.route('/products/add', methods=['GET', 'POST'])
def add_product():
Â Â Â Â suppliers = Supplier.query.all()
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â name = request.form['name']
Â Â Â Â Â Â Â Â price = request.form['price']
Â Â Â Â Â Â Â Â supplier_id = request.form.get('supplier_id')
Â Â Â Â Â Â Â Â new_product = Product(name=name, price=price, supplier_id=supplier_id)
Â Â Â Â Â Â Â Â db.session.add(new_product)
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash("ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­ âœ…")
Â Â Â Â Â Â Â Â return redirect('/products')
Â Â Â Â return render_template_string("""
Â Â Â Â <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h2>
Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Ø§Ù„Ø§Ø³Ù…: <input type="text" name="name"><br>
Â Â Â Â Â Â Â Â Ø§Ù„Ø³Ø¹Ø±: <input type="number" step="0.01" name="price"><br>
Â Â Â Â Â Â Â Â Ø§Ù„Ù…ÙˆØ±Ø¯:
Â Â Â Â Â Â Â Â <select name="supplier_id">
Â Â Â Â Â Â Â Â Â Â Â Â {% for s in suppliers %}
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <option value="{{ s.id }}">{{ s.name }}</option>
Â Â Â Â Â Â Â Â Â Â Â Â {% endfor %}
Â Â Â Â Â Â Â Â </select><br>
Â Â Â Â Â Â Â Â <button type="submit">Ø­ÙØ¸</button>
Â Â Â Â </form>
Â Â Â Â """, suppliers=suppliers)
@app.route('/products/edit/<int:id>', methods=['GET', 'POST'])
def edit_product(id):
Â Â Â Â product = Product.query.get_or_404(id)
Â Â Â Â if request.method == 'POST':
Â Â Â Â Â Â Â Â product.name = request.form['name']
Â Â Â Â Â Â Â Â product.price = request.form['price']
Â Â Â Â Â Â Â Â db.session.commit()
Â Â Â Â Â Â Â Â flash("ØªÙ… ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬ âœ…")
Â Â Â Â Â Â Â Â return redirect('/products')
Â Â Â Â return render_template_string("""
Â Â Â Â <h2>âœï¸ ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬</h2>
Â Â Â Â <form method="POST">
Â Â Â Â Â Â Â Â Ø§Ù„Ø§Ø³Ù…: <input type="text" name="name" value="{{product.name}}"><br>
Â Â Â Â Â Â Â Â Ø§Ù„Ø³Ø¹Ø±: <input type="number" step="0.01" name="price" value="{{product.price}}"><br>
Â Â Â Â Â Â Â Â <button type="submit">Ø­ÙØ¸</button>
Â Â Â Â </form>
Â Â Â Â """, product=product)
@app.route('/products/delete/<int:id>')
def delete_product(id):
Â Â Â Â product = Product.query.get_or_404(id)
Â Â Â Â db.session.delete(product)
Â Â Â Â db.session.commit()
Â Â Â Â flash("ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ âŒ")
Â Â Â Â return redirect('/products')
# ØªØ´ØºÙŠÙ„ Ø§Ù„Ø³ÙŠØ±ÙØ±
if __name__ == "__main__":
Â Â Â Â with app.app_context():
Â Â Â Â Â Â Â Â db.create_all()
Â Â Â Â app.run(debug=True, host="0.0.0.0", port=5000)
